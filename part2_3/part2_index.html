<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>GBA Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet" />
  <link href="https://unpkg.com/mapbox-gl-compare@0.4.0/dist/mapbox-gl-compare.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      scroll-snap-type: y mandatory;
      overflow-y: scroll;
      height: 100%;
    }
    .page {
      height: 100vh;
      scroll-snap-align: start;
      position: relative;
      overflow: hidden;
    }
  </style>
</head>
  
  
<body>
<!----page 1---->
<div id="page1" class="page">
  <style>
  #page1 body {
  margin: 0;
  padding: 0;
  font-family: Arial, sans-serif;
}

#page1 #map {
  flex: 1;
  height: 100%;
  min-width: 1px;
}

#page1 #proj_3_map_main,
#page1 #proj_3_map {
  width: 100%;
  height: 100%;
  position: absolute;
  top: 0;
  bottom: 0;
  z-index: -1;
}

#page1 #controls {
  position: absolute;
  top: 20px;
  left: 20px;
  background: #333;
  color: #f0f0f0;
  padding: 16px;
  border-radius: 8px;
  font-size: 13px; /* 正文字体大小 */
  font-family: Arial, sans-serif;
  max-width: 260px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.25);
  z-index: 1000;
}

/* 主标题 */
#page1 #controls > div:first-child {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 12px;
}

#page1 select,
#page1 input[type="range"] {
  margin: 5px 0;
  width: 100%;
}

#page1 .map_button {
  background-color: #555;
  color: white;
  font-size: 13px;
  text-align: center;
  margin-bottom: 8px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  padding: 6px 10px;
  width: 100%;
}

#page1 .drop_down {
  width: 100%;
  height: 30px;
  text-align: center;
  font-size: 13px;
}

#page1 .colour_intense {
  background: linear-gradient(
    to right,
    rgba(45, 196, 178, 0.5),
    rgba(59, 179, 195, 0.5),
    rgba(102, 158, 196, 0.5),
    rgba(139, 136, 182, 0.5),
    rgba(162, 113, 155, 0.5),
    rgba(170, 94, 121, 0.5)
  );
  border-radius: 4px;
  height: 12px;
  margin: 4px 0;
}
    
.colour_legend {
  display: flex;
  gap: 6px;
  margin: 6px 0;
  align-items: center;
}

.colour_dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  display: inline-block;
}

#page1 .legend_label {
  width: 16.5%;
  display: inline-block;
  text-align: center;
  font-size: 13px; /* 原来是12px */
  color: #ccc;
}

.section-title {
  font-size: 14px;
  font-weight: bold;
  color: #f0f0f0;
  margin: 12px 0 6px;
}

.section-box {
  margin-bottom: 18px;
  border-bottom: 1px solid #555;
  padding-bottom: 10px;
}

.desc-text {
  font-size: 13px; /* 原来是12px */
  color: #ccc;
  line-height: 1.4;
  margin-bottom: 6px;
}


  </style>
  
  <div id="map">
    <div id="controls">
      <div class="section-title">Mobility Flow Map</div>
      <div class="section-box">
        <p class="desc-text">This map visualizes the intensity and direction of intercity travel flows in the GBA.</p>
      </div>

      <div class="section-box">
        <div class="section-title">Data Exploratory Controls</div>
        <label for="pageSelector">Select Time Period:</label>
        <select class="drop_down" id="pageSelector">
          <option value="1">Monthly</option>
          <option value="2">Weekdays</option>
          <option value="3">Weekends</option>
          <option value="4">Holidays</option>
        </select>

        <label for="flowTypeSelector">Flow Type:</label>
        <select class="drop_down" id="flowTypeSelector">
          <option value="total">Total flow</option>
          <option value="net">Net flow</option>
        </select>
      </div>

      <div class="section-box">
        <div class="section-title">Colour Scale</div>
        <div class="colour_peak row"></div>

        <!-- 图例：Total flow -->
        <div class="colour_legend" id="legend-total">
          <span class="colour_dot" style="background: #156ba0;"></span><span class="legend_value">0-30</span>
          <span class="colour_dot" style="background: #719ab4;"></span><span class="legend_value">30-100</span>
          <span class="colour_dot" style="background: #8da0cb;"></span><span class="legend_value">100-400</span>
          <span class="colour_dot" style="background: #d8e4ff;"></span><span class="legend_value">400-800</span>
        </div>


        <!-- 图例：Net flow -->
        <div class="colour_legend" id="legend-net" style="display: none;">
          <span class="colour_dot" style="background: #109221;"></span><span class="legend_value">0-1</span>
          <span class="colour_dot" style="background: #5ca866;"></span><span class="legend_value">1-10</span>
          <span class="colour_dot" style="background: #8cdcc2;"></span><span class="legend_value">10-20</span>
          <span class="colour_dot" style="background: #a9f1a1;"></span><span class="legend_value">20-40</span>
          <span class="colour_dot" style="background: #d1ffd8;"></span><span class="legend_value">40+</span>
        </div>
      </div>

      <div class="section-box">
        <div class="section-title">Temporal Controls</div>
        <button class="map_button" id="button_play">Play</button>
        <button class="map_button" id="button_pause">Pause</button>
        <label id="slider_label">Month: <span id="slider_value_text">Jan 2024</span></label>
        <input class="row" id="monthSlider" type="range" min="1" max="12" value="1" step="1">
      </div>

      <div class="section-box">
        <div class="section-title">Top 3 Flows</div>
        <canvas height="200" id="barChart" width="300"></canvas>
      </div>
    </div>
  </div>

</div>

  
<!----page 2---->
<div id="page2" class="page">
  <style>

#page2 {
  margin: 0;
  padding: 0;
  height: 100%;
  font-family: Arial, sans-serif;
  background: #000000;
  color: #eee;
  overflow: hidden;
}

#page2 #buttons {
      margin: 16px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }
#page2 #buttons button {
      margin: 4px;
      padding: 6px 12px;
      background: #333;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }
#page2 #buttons button.active {
      background: #8da0cb;
    }
#page2 #charts {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 8px 16px 16px;
      height: calc(100vh - 160px);
      box-sizing: border-box;
      justify-items: center;
    }
#page2 .chart-container {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 36px 6px 6px 6px;
      width: 90%;
      height: 100%;
      position: relative;
      box-sizing: border-box;
      
    }
#page2 .chart-container.fullscreen {
      grid-column: 1 / span 3;
      width: 100%;
      height: 100%;
    }
#page2 .chart-label {
      position: absolute;
      top: 8px;
      left: 10px;
      font-size: 12px;
      font-weight: bold;
      color: #fff;
      z-index: 10;
    }
#page2 .legend-fixed {
      position: absolute;
      top: 16px;
      left: 16px;
      font-size: 13px;
      color: #eee;
    }
#page2 .legend-fixed span {
      margin-right: 12px;
    }
#page2 .legend-color {
      display: inline-block;
      width: 12px;
      height: 12px;
      margin-right: 4px;
      border-radius: 2px;
    }
#page2 canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      z-index: 1;
    }
#page2 h2 {
      text-align: center;
      margin: 16px 0 0;
    }
  
#page2 #time-selector button {
  margin: 6px 6px 10px;
  padding: 6px 14px;
  background: #555;
  border: none;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}
#page2 #time-selector button.active {
  background: #8da0cb;
}

  
</style>
  
<h2>Monthly Flow per City (In/Out/Net)</h2>

<!-- 时间选择按钮 -->
<div id="time-selector" style="text-align:center; margin-top: 10px;">
  <button class="time-btn active" data-time="monthly">Monthly</button>
  <button class="time-btn" data-time="weekly">Weekly</button>
  <button class="time-btn" data-time="holiday">Holiday</button>
</div>
  
<div class="legend-fixed">
  <span><span class="legend-color" style="background:#66c2a5"></span>In-Flow</span>
  <span><span class="legend-color" style="background:#fc8d62"></span>Out-Flow</span>
  <span><span class="legend-color" style="background:#8da0cb"></span>Net Positive</span>
  <span><span class="legend-color" style="background:#e78ac3"></span>Net Negative</span>
</div>
  
<div id="buttons"></div>
  
<div id="charts"></div>


</div>

<!----page 3---->
<div id="page3" class="page">
  <style>
    #page3 body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }

    /* 地图容器全屏 */
    #page3 #comparison-container {
      position: relative;
      width: 100%;
      height: 100vh;
    }

    #page3 #map-left,
    #page3 #map-right {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    /* 浮动控制面板 */
    #page3 #controls {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(30, 30, 30, 0.95);
      color: #f0f0f0;
      padding: 16px;
      border-radius: 8px;
      font-size: 13px;
      font-family: Arial, sans-serif;
      max-width: 300px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.25);
      z-index: 1000;
    }

    /* 主标题 */
    #page3 #controls > .main-title {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 12px;
    }

    .section-title {
      font-size: 14px;
      font-weight: bold;
      margin: 12px 0 6px;
      color: #f0f0f0;
    }

    .desc-text {
      font-size: 13px;
      color: #ccc;
      line-height: 1.4;
      margin-bottom: 6px;
    }

    #page3 #metricGroupButtons button {
      margin: 5px 4px 8px 0;
      padding: 6px 12px;
      font-size: 13px;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    #page3 #metricGroupButtons button:hover {
      background-color: #666;
    }

    #page3 .legend-color {
      display: inline-block;
      width: 16px;
      height: 16px;
      margin-right: 8px;
      vertical-align: middle;
      border-radius: 3px;
    }

    #page3 #tooltip {
      position: absolute;
      display: none;
      pointer-events: none;
      background: white;
      border-radius: 4px;
      padding: 6px 10px;
      font-size: 13px;
      border: 1px solid #ccc;
      box-shadow: 0 1px 4px rgba(0,0,0,0.3);
      z-index: 999;
    }
    
    #page3 #barChart {
      display: block;
      width: 260px;
      height: 200px;
      margin-top: 10px;
      border: 1px solid #999;
      background: white;
    }

  </style>

  <div id="comparison-container">
    <div id="map-left"></div>
    <div id="map-right"></div>

    <!-- 浮动控制面板 -->
    <div id="controls">
      <div class="main-title">Centrality Map</div>

      <div class="section-box">
        <div class="desc-text">
          This map compares city centrality in the GBA using three indicators: <strong>Degree</strong>, <strong>Closeness</strong>, and <strong>Betweenness</strong>.
        </div>
        <ul class="desc-text" style="padding-left: 18px; margin: 0;">
          <li><strong>Degree</strong> reflects how actively a city is connected in the regional mobility network.</li>
          <li><strong>Closeness</strong> shows how easily a city reaches others, based on <strong>Flow</strong> and <strong>Distance</strong>.</li>
          <li><strong>Betweenness</strong> captures how often a city acts as a bridge in shortest paths.</li>
        </ul>
        <div class="desc-text" style="margin-top: 8px;">
          Each circle’s color and size show the selected indicator value. Hover to see radar chart of all six metrics.
        </div>
      </div>

      <div class="section-box">
        <div class="section-title">Indicator Group</div>
        <div id="metricGroupButtons">
          <button data-group="group1">Degree</button>
          <button data-group="group2">Closeness</button>
          <button data-group="group3">Betweenness</button>
        </div>
      </div>

      <!-- Legend -->
      <div class="section-box">
        <div class="section-title">Legend</div>
        <div id="legend-container"></div>
      </div>

      <div class="section-box">
        <div class="section-title">Top 3 Cities</div>
        <canvas id="barChart" width="260" height="200"></canvas>
      </div>
      
    </div>
  </div>

  <div id="tooltip"></div>
</div>


<!----page 4---->
<div id="page4" class="page">
  <style>
    #page4 {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: Arial, sans-serif;
      background: #000000;
      color: #eee;
      overflow: hidden;
    }

    #page4 h2 {
      text-align: center;
      margin: 16px 0 0;
    }

    #page4 #buttons {
      margin: 16px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    #page4 #buttons button {
      margin: 4px;
      padding: 6px 12px;
      background: #333;
      border: none;
      color: white;
      border-radius: 4px;
      cursor: pointer;
    }

    #page4 #buttons button.active {
      background: #8da0cb;
    }

    #page4 #charts {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 8px 16px 16px;
      height: calc(100vh - 160px);
      box-sizing: border-box;
      justify-items: center;
    }

    #page4 .chart-container {
      background: #1a1a1a;
      border-radius: 8px;
      padding: 36px 6px 6px 6px;
      width: 90%;
      height: 100%;
      position: relative;
      box-sizing: border-box;
    }

    #page4 .chart-container.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 999;
      background-color: #1a1a1a;
      padding: 36px 6px 6px 6px;
      box-sizing: border-box;
      border-radius: 0;
    }

    #page4 .chart-label {
      position: absolute;
      top: 8px;
      left: 10px;
      font-size: 12px;
      font-weight: bold;
      color: #fff;
      z-index: 10;
    }

    #page4 canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
      z-index: 1;
    }
  </style>

  <h2>City Centrality Radar Charts</h2>
  <div id="buttons">
    <button class="active" data-index="all">All</button>
  </div>
  <div id="charts">
    <div class="chart-container" id="container0"><div class="chart-label">City 1</div><canvas id="chart0"></canvas></div>
    <div class="chart-container" id="container1"><div class="chart-label">City 2</div><canvas id="chart1"></canvas></div>
    <div class="chart-container" id="container2"><div class="chart-label">City 3</div><canvas id="chart2"></canvas></div>
    <div class="chart-container" id="container3"><div class="chart-label">City 4</div><canvas id="chart3"></canvas></div>
    <div class="chart-container" id="container4"><div class="chart-label">City 5</div><canvas id="chart4"></canvas></div>
    <div class="chart-container" id="container5"><div class="chart-label">City 6</div><canvas id="chart5"></canvas></div>
    <div class="chart-container" id="container6"><div class="chart-label">City 7</div><canvas id="chart6"></canvas></div>
    <div class="chart-container" id="container7"><div class="chart-label">City 8</div><canvas id="chart7"></canvas></div>
    <div class="chart-container" id="container8"><div class="chart-label">City 9</div><canvas id="chart8"></canvas></div>
  </div>
  
  
  
</div>

  <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>
  <script src="https://unpkg.com/mapbox-gl-compare@0.4.0/dist/mapbox-gl-compare.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="part2_1.js"></script>
  <script src="part2_2.js"></script>
  <script src="part2_3.js"></script>
  <script src="part2_4.js"></script>
</body>
</html>
